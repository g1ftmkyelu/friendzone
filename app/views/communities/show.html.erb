<div class="max-w-4xl mx-auto px-4 py-8">
  <% if flash[:notice] %>
    <div class="bg-green-100 text-green-800 border border-green-200 rounded-md px-4 py-2 font-medium text-center mb-4"><%= flash[:notice] %></div>
  <% end %>
  <% if flash[:alert] %>
    <div class="bg-red-100 text-red-800 border border-red-200 rounded-md px-4 py-2 font-medium text-center mb-4"><%= flash[:alert] %></div>
  <% end %>

  <div class="bg-card text-card-foreground rounded-lg shadow-md p-8 mb-6">
    <h1 class="text-4xl font-bold text-foreground mb-2"><%= @community.name %></h1>
    <p class="text-sm text-muted-foreground mb-1">Created by <%= link_to @community.creator.username, user_path(@community.creator), class: "hover:underline" %></p>
    <p class="text-sm text-muted-foreground mb-4"><%= @community.members.count %> Members</p>
    <p class="text-base text-foreground leading-relaxed mb-6"><%= @community.description %></p>

    <div class="flex flex-wrap justify-center gap-3 mt-6">
      <%= link_to "Back to Communities", communities_path, class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>

      <% if logged_in? %>
        <% if @community.creator == current_user %>
          <%= link_to "Edit Community", edit_community_path(@community), class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>
          <%= button_to "Delete Community", community_path(@community), method: :delete, data: { confirm: "Are you sure you want to delete this community?" }, class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>
        <% else %>
          <% if @membership_status == 'accepted' %>
            <span class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-secondary text-secondary-foreground h-10 px-4 py-2"><i class="fa-solid fa-check mr-2"></i> Joined</span>
            <%= button_to '<i class="fa-solid fa-right-from-bracket mr-2"></i> Leave Community'.html_safe, community_community_membership_path(@community, current_user.community_memberships.find_by(community: @community)), method: :delete, data: { confirm: "Are you sure you want to leave this community?" }, class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>
          <% elsif @membership_status == 'pending' %>
            <span class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-secondary text-secondary-foreground h-10 px-4 py-2"><i class="fa-solid fa-hourglass-half mr-2"></i> Request Sent</span>
          <% else %>
            <%= button_to '<i class="fa-solid fa-user-plus mr-2"></i> Join Community'.html_safe, community_community_memberships_path(@community), method: :post, class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2" %>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <% if @memberships.any? %>
      <div class="mt-12 pt-6 border-t border-border">
        <h3 class="text-2xl font-semibold text-foreground mb-4">Members</h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
          <% @memberships.each do |membership| %>
            <div class="flex flex-col items-center text-center">
              <%= image_tag membership.user.avatar, alt: membership.user.username, class: "h-16 w-16 rounded-full object-cover mb-2 min-h-[64px] bg-muted", loading: "lazy" %>
              <%= link_to membership.user.username, user_path(membership.user), class: "font-semibold text-sm text-foreground hover:underline" %>
              <% if logged_in? && @community.creator == current_user && membership.user != current_user %>
                <%= button_to "Remove", community_community_membership_path(@community, membership), method: :delete, data: { confirm: "Are you sure you want to remove #{membership.user.username} from this community?" }, class: "inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-7 px-2 py-1 mt-2" %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <p class="text-center text-muted-foreground text-lg mt-8">No members yet, be the first to join!</p>
    <% end %>
  </div>
</div>